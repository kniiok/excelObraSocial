<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0e19" />
  <title>FactuExcel</title>
  <link rel="shortcut icon"
    href="logo.svg" type="image/svg+xml" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Work+Sans:wght@400;500;600&display=swap"
    rel="stylesheet">
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="brand">
        <img src="logo.svg" alt="FactuExcel" class="brand-logo" loading="lazy" width="128" height="128" />
        <div class="brand-copy">
          <p class="brand-kicker">Gestión médica</p>
          <h1>FactuExcel</h1>
        </div>
      </div>
      <p class="brand-description">
        Cargá tus prestaciones desde el teléfono y generá un Excel prolijo, listo para enviar a tu obra social.
      </p>
    </header>

    <main class="surface">
      <section class="period-panel" aria-labelledby="period-heading">
        <div class="panel-heading">
          <h2 id="period-heading">Periodo de facturación</h2>
          <span class="period-label" id="period-label"></span>
        </div>
        <div class="period-toggle" role="tablist" aria-label="Seleccioná el periodo">
          <button type="button" class="period-option is-active" data-period="previous" role="tab"
            aria-selected="true">
            Mes anterior
          </button>
          <button type="button" class="period-option" data-period="current" role="tab" aria-selected="false">
            Mes actual
          </button>
        </div>
        <p class="period-summary" id="period-summary"></p>
      </section>

      <section class="form-panel">
        <header class="form-heading">
          <h2 id="form-title">Nuevo cliente</h2>
          <p>Ingresá los datos tal como aparecerán en el comprobante.</p>
        </header>
        <form id="client-form" novalidate>
          <div class="field">
            <label for="fecha">Fecha</label>
            <input type="date" id="fecha" name="fecha" required />
            <small class="field-hint" id="fecha-hint"></small>
          </div>
          <div class="field">
            <label for="nombre">Nombre y Apellido</label>
            <input type="text" id="nombre" name="nombre" autocomplete="name" required
              placeholder="Ej. Juan Pérez" />
          </div>
          <div class="field-group">
            <div class="field">
              <label for="afiliado">Número de afiliado</label>
              <input type="text" id="afiliado" name="afiliado" inputmode="numeric" required placeholder="000000" />
            </div>
            <div class="field">
              <label for="codigo">Código</label>
              <input type="text" id="codigo" name="codigo" inputmode="numeric" required placeholder="0000" />
            </div>
          </div>
          <div class="field">
            <label for="descripcion">Descripción</label>
            <textarea id="descripcion" name="descripcion" rows="2" required
              placeholder="Detalle de la prestación"></textarea>
          </div>
          <div class="field">
            <label for="valor">Valor</label>
            <input type="number" id="valor" name="valor" step="0.01" inputmode="decimal" required
              placeholder="0.00" />
          </div>
          <div class="form-actions">
            <button type="button" id="next-btn" class="btn primary">Guardar y cargar otro</button>
            <button type="button" id="finish-btn" class="btn secondary">Finalizar y generar Excel</button>
          </div>
        </form>
      </section>

      <section class="list-panel" aria-live="polite">
        <header class="list-heading">
          <h2>Clientes cargados</h2>
            <div class="list-total">
              <span>Total estimado</span>
              <strong id="client-total">AR$ 0,00</strong>
          </div>
        </header>
        <div id="client-list" class="client-list">
          <p class="empty-state">Todavía no cargaste ningún cliente.</p>
        </div>
      </section>

      <section id="result-container" class="result-panel" hidden>
        <h2>Mensaje sugerido</h2>
        <p id="result-message"></p>
      </section>
    </main>

    <footer class="app-footer">
      <a href="https://www.instagram.com/tc.dev" target="_blank" rel="noopener noreferrer">
        © 2025 TCDEV
      </a>
    </footer>
  </div>

  <script>
    const EXCEL_TEMPLATE_BASE64 =
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACslMtOwzAQRfdI/IPlLUrcskAINe2CxxIqUT7AxJPGql/yuKX9eyYuLQiFVqjdxEo8c+/JxDejydoatoKI' +
  '2ruKD8sBZ+Bqr7SbV/xt9lTccoZJOiWNd1DxDSCfjC8vRrNNAGTU7bDibUrhTgisW7ASSx/A0U7jo5WJbuNcBFkv5BzE9WBwI2rvErhUpE6Dj0cP0MilSexx' +
  'TY+3JBEMcna/Ley8Ki5DMLqWiUjFyqlfLsWXQ0mduQZbHfCKMDgTvRZ560+HXeMLDSdqBWwqY3qWlkDE2ogPHxfv3i/Kwyo9nL5pdA3K10tLMygxRJAKW4Bk' +
  'TZnX0krt9uQHAHI1irwMz0zSvWAWPgaS6JuDyNfTGbLMMUdMGwN47sln0aPWrYygXlOkfJyd4Kf2QRA6PNPoA1KQIvx/DrukdN1FICGIScN3VvpO3N6SUnjy' +
  '5KHLuQLVZy7yj2X8CQAA//8DAFBLAwQUAAYACAAAACEAlwhFmPQAAABPAgAACwAIAl9yZWxzLy5yZWxzIKIEAiigAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKySTU/DMAyG70j8h8j31d2QEEJLd0FIuyFUfoBJ3A+1jaMkG92/J1yASmNw4Oiv149f' +
  'ebubp1EdOcRenIZ1UYJiZ8T2rtXwUj+u7kDFRM7SKI41nDjCrrq+2j7zSCkPxa73UWUVFzV0Kfl7xGg6nigW4tnlSiNhopTD0KInM1DLuCnLWwzfNaBaaKq9' +
  '1RD29gZUffJ58+/a0jS94Qcxh4ldOrMCeU7sLNuVD5ktpD5fo2oKLScNVsxTTkck74uMDQrPI23+jvTzuThxIkuJ0Ejgy0AfHReJ1v9p0tLGL3/mEd8kDK8i' +
  'wycMLt6gegcAAP//AwBQSwMEFAAGAAgAAAAhAAUJR2/zAAAAvgIAABoACAF4bC9fcmVscy93b3JrYm9vay54bWwucmVscyCiBAEooAABAAAAAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' +
  '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';

    const meses = [
      'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
      'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
    ];

    function capitalize(text) {
      if (!text) return '';
      return text.charAt(0).toUpperCase() + text.slice(1);
    }

    function escapeHtml(text) {
      if (text === null || text === undefined) return '';
      return String(text).replace(/[&<>"']/g, (char) => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[char]);
    }

    function sanitizeText(value) {
      if (value === null || value === undefined) {
        return '';
      }

      return String(value)
        .normalize('NFC')
        .replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F]/g, '')
        .replace(/\s+/g, ' ')
        .trim();
    }

    function numeroALetras(num) {
      const unidades = ['', 'uno', 'dos', 'tres', 'cuatro', 'cinco', 'seis', 'siete', 'ocho', 'nueve'];
      const especiales = ['diez', 'once', 'doce', 'trece', 'catorce', 'quince', 'dieciséis', 'diecisiete', 'dieciocho', 'diecinueve'];
      const decenas = ['', '', 'veinte', 'treinta', 'cuarenta', 'cincuenta', 'sesenta', 'setenta', 'ochenta', 'noventa'];
      const centenas = ['', 'ciento', 'doscientos', 'trescientos', 'cuatrocientos', 'quinientos', 'seiscientos', 'setecientos', 'ochocientos', 'novecientos'];

      if (num === 0) return 'cero';
      if (num === 100) return 'cien';

      let resultado = '';

      if (num >= 1_000_000) {
        const millones = Math.floor(num / 1_000_000);
        resultado += millones > 1 ? numeroALetras(millones) + ' millones' : 'un millón';
        num %= 1_000_000;
        if (num > 0) resultado += ' ';
      }

      if (num >= 1_000) {
        const miles = Math.floor(num / 1_000);
        resultado += miles > 1 ? numeroALetras(miles) + ' mil' : 'mil';
        num %= 1_000;
        if (num > 0) resultado += ' ';
      }

      if (num >= 100) {
        resultado += centenas[Math.floor(num / 100)];
        num %= 100;
        if (num > 0) resultado += ' ';
      }

      if (num >= 20) {
        resultado += decenas[Math.floor(num / 10)];
        if (num % 10 > 0) resultado += ' y ' + unidades[num % 10];
      } else if (num >= 10) {
        resultado += especiales[num - 10];
      } else if (num > 0) {
        resultado += unidades[num];
      }

      return resultado;
    }

    function deepCloneStyle(style) {
      return style ? JSON.parse(JSON.stringify(style)) : undefined;
    }

    function setCell(worksheet, address, type, value, style) {
      const cell = { t: type, v: value };
      if (style) {
        cell.s = deepCloneStyle(style);
      }
      worksheet[address] = cell;
    }

    function roundCurrency(value) {
      const numericValue = Number.parseFloat(value);
      if (!Number.isFinite(numericValue)) {
        return 0;
      }
      return Math.round(numericValue * 100) / 100;
    }

    const clients = {
      previous: [],
      current: []
    };
    let activePeriod = 'previous';
    let currentRange = null;
    let lastRenderedTotal = 0;

    const clientForm = document.getElementById('client-form');
    const formTitle = document.getElementById('form-title');
    const dateInput = document.getElementById('fecha');
    const dateHint = document.getElementById('fecha-hint');
    const periodSummary = document.getElementById('period-summary');
    const periodLabel = document.getElementById('period-label');
    const clientList = document.getElementById('client-list');
    const clientTotal = document.getElementById('client-total');
    const resultPanel = document.getElementById('result-container');
    const resultMessage = document.getElementById('result-message');

    function updateTotalDisplay(total) {
      const shouldAnimate = total !== lastRenderedTotal;
      clientTotal.textContent = formatCurrency(total);

      if (shouldAnimate) {
        clientTotal.classList.remove('is-updated');
        void clientTotal.offsetWidth;
        clientTotal.classList.add('is-updated');
      }

      lastRenderedTotal = total;
    }

    function animateLatestRow() {
      const latestRow = clientList.querySelector('.client-table tbody tr:last-child');
      if (!latestRow) return;

      latestRow.classList.add('is-entering');
      setTimeout(() => latestRow.classList.remove('is-entering'), 600);
    }

    function computeRange(period) {
      const hoy = new Date();
      if (period === 'previous') {
        const inicio = new Date(hoy.getFullYear(), hoy.getMonth() - 1, 1);
        const fin = new Date(hoy.getFullYear(), hoy.getMonth(), 0);
        return {
          start: inicio,
          end: fin,
          monthName: meses[inicio.getMonth()],
          year: inicio.getFullYear(),
          description: 'Mes anterior'
        };
      }

      const inicio = new Date(hoy.getFullYear(), hoy.getMonth(), 1);
      const fin = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate());
      return {
        start: inicio,
        end: fin,
        monthName: meses[inicio.getMonth()],
        year: inicio.getFullYear(),
        description: 'Mes actual'
      };
    }

    function formatDateInput(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function formatDateDisplay(date) {
      return date.toLocaleDateString('es-AR', {
        day: '2-digit',
        month: 'long',
        year: 'numeric'
      });
    }

    function formatDateShort(date) {
      return date.toLocaleDateString('es-AR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }

    function formatExcelDateFromISO(iso) {
      const [year, month, day] = iso.split('-').map(Number);
      return `${String(day).padStart(2, '0')}/${String(month).padStart(2, '0')}/${year}`;
    }

    function formatCurrency(value) {
      return new Intl.NumberFormat('es-AR', {
        style: 'currency',
        currency: 'ARS',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(value);
    }

    function setPeriod(period) {
      activePeriod = period;
      currentRange = computeRange(period);

      document.querySelectorAll('.period-option').forEach((btn) => {
        const isActive = btn.dataset.period === period;
        btn.classList.toggle('is-active', isActive);
        btn.setAttribute('aria-selected', String(isActive));
      });

      periodLabel.textContent = `${capitalize(currentRange.monthName)} ${currentRange.year}`;
      periodSummary.textContent = `Podés cargar prestaciones desde el ${formatDateDisplay(currentRange.start)} hasta el ${formatDateDisplay(currentRange.end)}.`;

      dateInput.min = formatDateInput(currentRange.start);
      dateInput.max = formatDateInput(currentRange.end);
      dateInput.value = formatDateInput(currentRange.end);
      dateHint.textContent = `Fechas habilitadas: ${formatDateDisplay(currentRange.start)} al ${formatDateDisplay(currentRange.end)}.`;

      renderClientList();
      updateFormTitle();
      resultPanel.hidden = true;
      resultMessage.textContent = '';
    }

    function getFormData() {
      const rawDate = dateInput.value;
      const nombre = sanitizeText(document.getElementById('nombre').value);
      const afiliado = sanitizeText(document.getElementById('afiliado').value);
      const codigo = sanitizeText(document.getElementById('codigo').value);
      const descripcion = sanitizeText(document.getElementById('descripcion').value);
      const valor = parseFloat(document.getElementById('valor').value);

      if (!rawDate || !nombre || !afiliado || !codigo || !descripcion || Number.isNaN(valor)) {
        return null;
      }

      return {
        fechaISO: rawDate,
        nombre,
        afiliado,
        codigo,
        descripcion,
        valor: roundCurrency(valor)
      };
    }

    function resetForm() {
      clientForm.reset();
      if (currentRange) {
        dateInput.value = formatDateInput(currentRange.end);
      }
      dateInput.focus({ preventScroll: true });
    }

    function updateFormTitle() {
      const nextNumber = clients[activePeriod].length + 1;
      formTitle.textContent = `Cliente ${nextNumber}`;
      document.title = `Cliente ${nextNumber} · FactuExcel`;
    }

    function renderClientList() {
      const activeClients = clients[activePeriod];

      if (!activeClients.length) {
        clientList.innerHTML = '<p class="empty-state">Todavía no cargaste ningún cliente.</p>';
        updateTotalDisplay(0);
        return;
      }

      const rows = activeClients
        .map((client, index) => {
          const date = new Date(`${client.fechaISO}T00:00:00`);
          const nombre = escapeHtml(client.nombre);
          const afiliado = escapeHtml(client.afiliado);
          const codigo = escapeHtml(client.codigo);
          const descripcion = escapeHtml(client.descripcion);

          return `
            <tr>
              <th scope="row">
                <span class="client-index">${String(index + 1).padStart(2, '0')}</span>
              </th>
              <td data-column="fecha">
                <span class="cell-primary">${formatDateDisplay(date)}</span>
                <span class="cell-secondary">${formatDateShort(date)}</span>
              </td>
              <td data-column="nombre">
                <span class="cell-primary">${nombre}</span>
              </td>
              <td data-column="afiliado" class="mono">${afiliado}</td>
              <td data-column="codigo" class="mono">${codigo}</td>
              <td data-column="descripcion" title="${descripcion}">
                <span class="cell-primary">${descripcion}</span>
              </td>
              <td data-column="valor" class="is-numeric">${formatCurrency(client.valor)}</td>
            </tr>
          `;
        })
        .join('');

      const chipPieces = [
        `<span class="client-chip"><strong>${activeClients.length}</strong> ${activeClients.length === 1 ? 'cliente' : 'clientes'}</span>`
      ];

      if (currentRange) {
        chipPieces.push(
          `<span class="client-chip client-chip--ghost">${capitalize(currentRange.monthName)} ${currentRange.year}</span>`
        );
        chipPieces.push(
          `<span class="client-chip client-chip--ghost">${formatDateShort(currentRange.start)} — ${formatDateShort(currentRange.end)}</span>`
        );
      }

      const captionText = currentRange
        ? `Prestaciones cargadas · ${capitalize(currentRange.monthName)} ${currentRange.year}`
        : 'Prestaciones cargadas';

      clientList.innerHTML = `
        <div class="client-overview" role="status">${chipPieces.join('')}</div>
        <div class="client-table-wrapper">
          <table class="client-table">
            <caption class="visually-hidden">${captionText}</caption>
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Fecha</th>
                <th scope="col">Paciente</th>
                <th scope="col">Afiliado</th>
                <th scope="col">Código</th>
                <th scope="col">Descripción</th>
                <th scope="col" class="is-numeric">Valor</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        </div>
      `;

      const total = activeClients.reduce((acc, client) => acc + client.valor, 0);
      updateTotalDisplay(total);
    }

    function isFormDirty() {
      return Array.from(clientForm.elements)
        .filter((el) => ['INPUT', 'TEXTAREA'].includes(el.tagName))
        .some((el) => el.value.trim() !== '');
    }

    function addClient() {
      const data = getFormData();
      if (!data) {
        alert('Revisá que todos los campos estén completos antes de guardar.');
        return false;
      }

      clients[activePeriod].push(data);
      renderClientList();
      requestAnimationFrame(animateLatestRow);
      resetForm();
      updateFormTitle();

      clientForm.classList.add('is-saving');
      setTimeout(() => clientForm.classList.remove('is-saving'), 250);
      resultPanel.hidden = true;
      resultMessage.textContent = '';
      return true;
    }

    function generateExcel() {
      const clientsForPeriod = clients[activePeriod];

      if (!clientsForPeriod.length || !currentRange) {
        return;
      }

      const workbook = XLSX.read(EXCEL_TEMPLATE_BASE64, {
        type: 'base64',
        cellStyles: true
      });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];

      const baseStyles = {
        date: deepCloneStyle(worksheet['A2']?.s),
        name: deepCloneStyle(worksheet['B2']?.s),
        affiliate: deepCloneStyle(worksheet['C2']?.s),
        code: deepCloneStyle(worksheet['D2']?.s),
        description: deepCloneStyle(worksheet['E2']?.s),
        amount: deepCloneStyle(worksheet['F2']?.s),
        totalLabel: deepCloneStyle(worksheet['A6']?.s),
        totalValue: deepCloneStyle(worksheet['B6']?.s),
        wordsLabel: deepCloneStyle(worksheet['A7']?.s),
        wordsValue: deepCloneStyle(worksheet['B7']?.s)
      };

      const baseFormats = {
        amount: worksheet['F2']?.z,
        total: worksheet['B6']?.z
      };

      const dataStartRow = 2;
      const addressPattern = /^([A-Z]+)(\d+)$/;

      Object.keys(worksheet).forEach((address) => {
        if (address.startsWith('!')) return;
        const match = addressPattern.exec(address);
        if (!match) return;
        const rowIndex = Number(match[2]);
        if (rowIndex >= dataStartRow) {
          delete worksheet[address];
        }
      });

      const sortedClients = clientsForPeriod
        .map((client) => ({
          ...client,
          nombre: sanitizeText(client.nombre),
          afiliado: sanitizeText(client.afiliado),
          codigo: sanitizeText(client.codigo),
          descripcion: sanitizeText(client.descripcion),
          valor: roundCurrency(client.valor)
        }))
        .sort((a, b) => {
          if (a.fechaISO === b.fechaISO) {
            return a.nombre.localeCompare(b.nombre, 'es', { sensitivity: 'base' });
          }
          return a.fechaISO.localeCompare(b.fechaISO);
        });

      sortedClients.forEach((client, index) => {
        const targetRow = dataStartRow + index;
        setCell(worksheet, `A${targetRow}`, 's', formatExcelDateFromISO(client.fechaISO), baseStyles.date);
        setCell(worksheet, `B${targetRow}`, 's', client.nombre, baseStyles.name);
        setCell(worksheet, `C${targetRow}`, 's', client.afiliado, baseStyles.affiliate);
        setCell(worksheet, `D${targetRow}`, 's', client.codigo, baseStyles.code);
        setCell(worksheet, `E${targetRow}`, 's', client.descripcion, baseStyles.description);

        const amountCell = {
          t: 'n',
          v: roundCurrency(client.valor)
        };
        if (baseStyles.amount) {
          amountCell.s = deepCloneStyle(baseStyles.amount);
        }
        if (baseFormats.amount) {
          amountCell.z = baseFormats.amount;
        }
        worksheet[`F${targetRow}`] = amountCell;
      });

      const dataEndRow = dataStartRow + sortedClients.length - 1;
      const totalRowIndex = dataEndRow + 3;
      const wordsRowIndex = totalRowIndex + 1;

      setCell(worksheet, `A${totalRowIndex}`, 's', 'TOTAL', baseStyles.totalLabel);

      const totalCell = {
        t: 'n',
        f: `SUM(F${dataStartRow}:F${dataEndRow})`
      };
      if (baseStyles.totalValue) {
        totalCell.s = deepCloneStyle(baseStyles.totalValue);
      }
      if (baseFormats.total) {
        totalCell.z = baseFormats.total;
      }
      worksheet[`B${totalRowIndex}`] = totalCell;

      const total = sortedClients.reduce((sum, client) => sum + client.valor, 0);
      const roundedTotal = roundCurrency(total);
      const integerPart = Math.floor(roundedTotal);
      const cents = Math.round((roundedTotal - integerPart) * 100);
      const wordsBase = numeroALetras(integerPart);
      const currencyWord = integerPart === 1 ? 'peso' : 'pesos';
      const centsWord = cents === 1 ? 'centavo' : 'centavos';
      const wordsText = cents
        ? `${capitalize(wordsBase)} ${currencyWord} con ${String(cents).padStart(2, '0')} ${centsWord}`
        : `${capitalize(wordsBase)} ${currencyWord}`;

      const formattedWordsText = sanitizeText(wordsText);

      setCell(worksheet, `A${wordsRowIndex}`, 's', 'Total facturado:', baseStyles.wordsLabel);
      setCell(worksheet, `B${wordsRowIndex}`, 's', formattedWordsText, baseStyles.wordsValue);

      worksheet['!ref'] = `A1:F${wordsRowIndex}`;

      const filename = `facturacion_${currentRange.monthName}_${currentRange.year}.xlsx`;
      XLSX.writeFile(workbook, filename, { compression: true });
    }

    function showResultMessage() {
      const total = clients[activePeriod].reduce((sum, client) => sum + client.valor, 0);
      const formattedTotal = formatCurrency(total);
      const message = `Buenos días.\nAdjunto facturación mes de ${capitalize(currentRange.monthName)} ${currentRange.year}.\nTroncoso María Cristina\nNum. Prestador 107968.\nTotal: ${formattedTotal}.`;

      resultMessage.textContent = message;
      resultPanel.hidden = false;
      resultPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    document.querySelectorAll('.period-option').forEach((button) => {
      button.addEventListener('click', () => {
        if (button.dataset.period !== activePeriod) {
          setPeriod(button.dataset.period);
        }
      });
    });

    document.getElementById('next-btn').addEventListener('click', () => {
      if (clientForm.reportValidity()) {
        addClient();
      }
    });

    document.getElementById('finish-btn').addEventListener('click', () => {
      if (isFormDirty()) {
        if (!clientForm.reportValidity() || !addClient()) {
          return;
        }
      }

      if (!clients[activePeriod].length) {
        alert('Necesitás agregar al menos un cliente para generar el Excel.');
        return;
      }

      generateExcel();
      showResultMessage();
    });

    setPeriod(activePeriod);
  </script>
</body>

</html>